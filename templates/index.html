<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UWorld to Anki Converter</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>UWorld to Anki Tag Converter</h1>

        <!-- Input Section -->
        <label for="input_ids">Input Question IDs (comma-separated):</label>
        <textarea id="input_ids" rows="4" placeholder="e.g., 23596, 25401, 23175"></textarea>

        <!-- Generate Button -->
        <button id="generate_list">Generate List</button>

        <!-- Mode Selection -->
        <div id="mode_section">
            <label><input type="radio" name="mode" value="All" checked> All</label>
            <label><input type="radio" name="mode" value="Select Questions"> Selected Questions</label>
            <label><input type="radio" name="mode" value="Exclude Questions"> Exclude Questions</label>
        </div>

        <!-- Generated Questions -->
        <div id="question_list"></div>

        <!-- Output Section -->
        <button id="generate_output">Generate Output</button>
        <label for="output_text">Generated Output:</label>
        <textarea id="output_text" rows="5" readonly></textarea>
    </div>

    <script>
        document.getElementById("generate_list").addEventListener("click", () => {
            const inputIDs = document.getElementById("input_ids").value.trim();
            const questionList = document.getElementById("question_list");
            questionList.innerHTML = "";

            if (!inputIDs) {
                alert("Please enter question IDs.");
                return;
            }

            const ids = inputIDs.split(",").map(id => id.trim()).filter(id => id);
            ids.forEach((id, index) => {
                const label = document.createElement("label");
                label.innerHTML = `<input type="checkbox" value="${index}"> ${index + 1}. ${id}`;
                questionList.appendChild(label);
                questionList.appendChild(document.createElement("br"));
            });
        });

        document.getElementById("generate_output").addEventListener("click", async () => {
            const inputIDs = document.getElementById("input_ids").value.trim();
            const mode = document.querySelector("input[name='mode']:checked").value;
            const selectedIndices = Array.from(document.querySelectorAll("#question_list input:checked"))
                                         .map(input => input.value);

            const response = await fetch("/process_ids", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams({ input_ids: inputIDs, mode: mode, selected_indices: selectedIndices })
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById("output_text").value = data.output;
            } else {
                const error = await response.json();
                alert(error.error);
            }
        });
    </script>
</body>
</html>
